@{
    ViewData["Title"] = "Início";
}

<main class="pt-5">

    <!-- Hero Section -->
    <section id="inicio" class="py-5">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6 mb-4 mb-md-0">
                    <h1 class="fw-bold display-5 mb-3" style="font-family: 'Raleway', sans-serif; color:#333;">
                        Descubra Hortas Urbanas Perto de Você
                    </h1>
                    <p class="fs-5 mb-3" style="color:#333;">
                        Conectamos você às hortas urbanas da sua região, promovendo uma alimentação saudável e sustentável.
                    </p>
                    <a href="#mapa" class="btn btn-lg" style="background-color:#007C46; border-color:#007C46; color:#F1F1F1;">
                        Explorar Hortas
                    </a>
                </div>
                <div class="col-md-6">
                    <img src="https://plus.unsplash.com/premium_photo-1678836292816-fdf0ac484cf1?q=80&w=1103&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
                         class="img-fluid rounded shadow" alt="Horta Urbana">
                </div>
            </div>
        </div>
    </section>

    <!-- Sobre Section 
        TODO:
    -->
    <section id="sobre" class="py-5" style="background-color:#F1F1F1;">
        <div class="container text-center">
            <h2 class="fw-bold display-6 mb-4" style="font-family: 'Raleway', sans-serif; color:#333;">Sobre o Hortalis</h2>
            <p class="fs-5 mb-5" style="color:#333;">
                O Hortalis é uma iniciativa que visa conectar pessoas a hortas urbanas locais, promovendo a agricultura urbana sustentável e o acesso a alimentos frescos e saudáveis.
            </p>

            <div class="row g-4">
                <div class="col-md-4 text-center p-3">
                    <div class="rounded-circle d-flex align-items-center justify-content-center mx-auto mb-3" style="width: 4rem; height: 4rem; background-color: rgba(0,124,70,0.1);">
                        <i class="fas fa-map-marker-alt" style="color: #007C46; font-size: 1.5rem;"></i>
                    </div>
                    <h5 class="fw-semibold mb-2" style="color:#333;">Mapeamento</h5>
                    <p style="color:#333;">Localizamos e mapeamos hortas urbanas para facilitar o acesso da comunidade.</p>
                </div>
                <div class="col-md-4 text-center p-3">
                    <div class="rounded-circle d-flex align-items-center justify-content-center mx-auto mb-3" style="width: 4rem; height: 4rem; background-color: rgba(0,124,70,0.1);">
                        <i class="fas fa-users" style="color: #007C46; font-size: 1.5rem;"></i>
                    </div>
                    <h5 class="fw-semibold mb-2" style="color:#333;">Comunidade</h5>
                    <p style="color:#333;">Fortalecemos laços entre produtores e consumidores locais.</p>
                </div>
                <div class="col-md-4 text-center p-3">
                    <div class="rounded-circle d-flex align-items-center justify-content-center mx-auto mb-3" style="width: 4rem; height: 4rem; background-color: rgba(0,124,70,0.1);">
                        <i class="fas fa-leaf" style="color: #007C46; font-size: 1.5rem;"></i>
                    </div>
                    <h5 class="fw-semibold mb-2" style="color:#333;">Sustentabilidade</h5>
                    <p style="color:#333;">Promovemos práticas sustentáveis e agricultura urbana responsável.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Map Section 
        TODO: Adicionar mapa. Ajustar Barra de busca.
    -->
    <section id="mapa" class="py-5">
        <div class="container text-center">
            <h2 class="fw-bold display-6 mb-4" style="color:#333;">Encontre Hortas Próximas</h2>

            <div class="mb-4 mx-auto" style="max-width: 600px;">
                <div class="position-relative">
                    <input type="text" id="searchInput" placeholder="Busque por alimentos (ex: alface, tomate, cenoura...)" class="form-control ps-5">
                    <span class="position-absolute top-50 start-0 translate-middle-y ps-3 text-success">
                        <i class="fas fa-search"></i> <!-- Ícone de lupa -->
                    </span>
                </div>
                <div id="searchResults" class="mt-2 text-muted d-none">
                    <span id="resultsCount">0</span> hortas encontradas
                </div>
                <div id="noResults" class="mt-3 alert alert-warning d-none">
                    Nenhuma horta encontrada com este alimento. Que tal experimentar: <span id="suggestions"></span>
                </div>
            </div>

            <div id="map" class="rounded shadow" style="height: 600px;"></div>
        </div>
    </section>        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">


    <!-- Contact Section -->
    <section id="contato" class="py-5" style="background-color:#F1F1F1;">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="fw-bold mb-3" style="color:#333;">Conhece uma Horta?</h2>
            <p class="lead" style="color:#333;">
                Indique rapidamente a localização. Para evitar variações no nome da área, a zona será gerada internamente com base na posição.
            </p>
        </div>

        <div class="row justify-content-center">
            <div class="col-lg-6">
                <!-- Formulário enxuto: apenas Nome, E-mail e localização -->
                <form id="indicarForm" method="post" action="/Home/EnviarIndicacao" class="p-4 rounded shadow" style="background: #D3E3DC;">
                    @Html.AntiForgeryToken()

                    <div class="mb-3">
                        <label for="nome" class="form-label fw-semibold" style="color:#333;">Seu Nome (opcional)</label>
                        <input type="text" class="form-control" id="nome" name="Nome" placeholder="Digite seu nome">
                    </div>

                    <div class="mb-3">
                        <label for="email" class="form-label fw-semibold" style="color:#333;">Seu E-mail (opcional)</label>
                        <input type="email" class="form-control" id="email" name="Email" placeholder="Digite seu email">
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-semibold" style="color:#333;">Localização (latitude / longitude)</label>
                        <div class="d-flex gap-2">
                            <input type="text" readonly class="form-control" id="latitude" name="Latitude" placeholder="Latitude" />
                            <input type="text" readonly class="form-control" id="longitude" name="Longitude" placeholder="Longitude" />
                        </div>
                        <div class="form-text">Clique no mapa abaixo para definir a localização ou use "Usar minha localização".</div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-semibold" style="color:#333;">Definir localização no mapa</label>
                        <div id="indicarMap" class="rounded shadow-sm" style="height:220px;"></div>
                        <div class="mt-2 d-flex gap-2">
                            <button type="button" id="useLocationBtn" class="btn btn-sm btn-outline-success">Usar minha localização</button>
                            <button type="button" id="clearLocationBtn" class="btn btn-sm btn-outline-secondary">Limpar localização</button>
                            <small class="text-muted align-self-center">Clique no mapa para posicionar o marcador.</small>
                        </div>
                    </div>

                    <div class="text-center mt-3">
                        <button type="submit" class="btn btn-lg px-5" style="background-color:#007C46; border-color:#007C46; color:#F1F1F1;">
                            Enviar indicação
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

    <!-- FAQ Section 
        TODO: Ao clicar no item do FAQ, a cor de selecionado deve ser verde.
    -->
    <section id="faq" class="py-5" style="background-color:#F1F1F1;">
        <div class="container">
            <div class="text-center mb-5">
                <h2 class="fw-bold mb-3" style="color:#333;">Dúvidas Frequentes</h2>
                <p class="lead" style="color:#333;">
                    Encontre respostas para as perguntas mais comuns sobre hortas urbanas e nossa plataforma.
                </p>
            </div>

            <div class="accordion" id="faqAccordion">
                <!-- FAQ Items -->
                @* FAQ 1 *@
                <div class="accordion-item">
                    <h2 class="accordion-header" id="faqHeading1">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapse1" aria-expanded="false" aria-controls="faqCollapse1" style="color:#333;">
                            Como posso participar de uma horta comunitária?
                        </button>
                    </h2>
                    <div id="faqCollapse1" class="accordion-collapse collapse" aria-labelledby="faqHeading1" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                            <ul>
                                <li>Localizar uma horta próxima usando nosso mapa</li>
                                <li>Entrar em contato diretamente com os responsáveis</li>
                                <li>Comparecer nos horários de funcionamento</li>
                                <li>Participar das atividades e mutirões organizados</li>
                                <li>Contribuir com seu tempo e conhecimento</li>
                            </ul>
                        </div>
                    </div>
                </div>

                @* FAQ 2 *@
                <div class="accordion-item">
                    <h2 class="accordion-header" id="faqHeading2">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapse2" aria-expanded="false" aria-controls="faqCollapse2" style="color:#333;">
                            Quais os benefícios de participar de uma horta solidária?
                        </button>
                    </h2>
                    <div id="faqCollapse2" class="accordion-collapse collapse" aria-labelledby="faqHeading2" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                            <ul>
                                <li>Acesso a alimentos frescos e orgânicos</li>
                                <li>Aprendizado sobre agricultura urbana</li>
                                <li>Conexão com a comunidade local</li>
                                <li>Contribuição para a sustentabilidade</li>
                                <li>Melhoria da saúde física e mental</li>
                                <li>Economia na compra de alimentos</li>
                            </ul>
                        </div>
                    </div>
                </div>

                @* FAQ 3 *@
                <div class="accordion-item">
                    <h2 class="accordion-header" id="faqHeading3">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapse3" aria-expanded="false" aria-controls="faqCollapse3" style="color:#333;">
                            Preciso levar alguma ferramenta ou equipamento?
                        </button>
                    </h2>
                    <div id="faqCollapse3" class="accordion-collapse collapse" aria-labelledby="faqHeading3" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                            Na maioria das hortas comunitárias, as ferramentas básicas são fornecidas. No entanto, é recomendável:
                            <ul>
                                <li>Levar luvas de jardinagem próprias</li>
                                <li>Usar roupas apropriadas para o trabalho</li>
                                <li>Levar protetor solar e chapéu</li>
                                <li>Garrafa de água</li>
                            </ul>
                        </div>
                    </div>
                </div>

                @* FAQ 4 *@
                <div class="accordion-item">
                    <h2 class="accordion-header" id="faqHeading4">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapse4" aria-expanded="false" aria-controls="faqCollapse4" style="color:#333;">
                            Como funciona a divisão dos alimentos colhidos?
                        </button>
                    </h2>
                    <div id="faqCollapse4" class="accordion-collapse collapse" aria-labelledby="faqHeading4" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                            <ul>
                                <li>Participantes ativos recebem parte da colheita</li>
                                <li>Existe um sistema de rodízio para colheita</li>
                                <li>Parte da produção pode ser doada</li>
                                <li>Alguns produtos podem ser vendidos para manutenção da horta</li>
                            </ul>
                        </div>
                    </div>
                </div>

                @* FAQ 5 *@
                <div class="accordion-item">
                    <h2 class="accordion-header" id="faqHeading5">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapse5" aria-expanded="false" aria-controls="faqCollapse5" style="color:#333;">
                            Posso levar crianças para a horta comunitária?
                        </button>
                    </h2>
                    <div id="faqCollapse5" class="accordion-collapse collapse" aria-labelledby="faqHeading5" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                            <p>Sim! A maioria das hortas comunitárias recebe bem as crianças. É uma ótima oportunidade para:</p>
                            <ul>
                                <li>Educação ambiental na prática</li>
                                <li>Aprendizado sobre alimentação saudável</li>
                                <li>Desenvolvimento de responsabilidade</li>
                                <li>Conexão com a natureza</li>
                            </ul>
                            <p>Apenas certifique-se de supervisionar as crianças e seguir as orientações específicas de cada horta.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

</main>

@section Scripts {
    <script>
        (function () {
            // Inicializa mapa pequeno de indicação
            if (typeof L === 'undefined') return;
            const mapEl = document.getElementById('indicarMap');
            if (!mapEl) return;

            const defaultCenter = [-21.6005831, -48.3630907]; // centro aproximado (Brasil)
            const map = L.map('indicarMap', { attributionControl: false }).setView(defaultCenter, 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19
            }).addTo(map);

            let marker = null;
            const latInput = document.getElementById('latitude');
            const lngInput = document.getElementById('longitude');

            function setMarker(lat, lng) {
                if (!isFinite(lat) || !isFinite(lng)) return;
                if (marker) {
                    marker.setLatLng([lat, lng]);
                } else {
                    marker = L.marker([lat, lng], { draggable: true }).addTo(map);
                    marker.on('dragend', function (e) {
                        const pos = e.target.getLatLng();
                        latInput.value = pos.lat.toFixed(6).replace(',', '.');
                        lngInput.value = pos.lng.toFixed(6).replace(',', '.');
                    });
                }
                latInput.value = lat.toFixed(6).replace(',', '.');
                lngInput.value = lng.toFixed(6).replace(',', '.');
            }

            map.on('click', function (e) {
                setMarker(e.latlng.lat, e.latlng.lng);
            });

            document.getElementById('useLocationBtn').addEventListener('click', function () {
                if (!navigator.geolocation) {
                    alert('Geolocalização não suportada pelo seu navegador.');
                    return;
                }
                navigator.geolocation.getCurrentPosition(function (pos) {
                    const lat = pos.coords.latitude;
                    const lng = pos.coords.longitude;
                    setMarker(lat, lng);
                    map.setView([lat, lng], 15);
                }, function () {
                    alert('Não foi possível obter sua localização.');
                }, { enableHighAccuracy: true, timeout: 10000 });
            });

            document.getElementById('clearLocationBtn').addEventListener('click', function () {
                if (marker) {
                    map.removeLayer(marker);
                    marker = null;
                }
                latInput.value = '';
                lngInput.value = '';
            });

            // Validação mínima antes do envio: exige Lat/Lng
            document.getElementById('indicarForm').addEventListener('submit', function (e) {
                let lat = document.getElementById('latitude').value.trim();
                let lng = document.getElementById('longitude').value.trim();

                // Normaliza vírgula para ponto
                lat = lat.replace(',', '.');
                lng = lng.replace(',', '.');
                document.getElementById('latitude').value = lat;
                document.getElementById('longitude').value = lng;

                if (!lat || !lng || !isFinite(parseFloat(lat)) || !isFinite(parseFloat(lng))) {
                    e.preventDefault();
                    alert('Por favor defina a localização clicando no mapa ou usando "Usar minha localização".');
                    return false;
                }
            });
        })();
    </script>
}
